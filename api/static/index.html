<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InvertOrNot</title>
    <meta name="description"
        content="InvertOrNot.com is a website for classifying images by how to display in web dark-mode">
    <meta name="keywords"
        content="dark mode, image inversion, API, open source, image processing, smart inversion, dark-mode optimization">
    <meta name="author" content="Mattis Megevand">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="InvertOrNot">
    <meta property="og:image" content="https://invertornot.com/static/queen_victoria.png">
    <meta property="og:title" content="InvertOrNot - Smart Dark-Mode Image Inversion">
    <meta property="og:description"
        content="InvertOrNot.com is a website for classifying images by how to display in web dark-mode">
    <meta property="og:image" content="static/examples.png">
    <meta property="og:url" content="https://invertornot.com">
    <meta property="twitter:title" content="InvertOrNot">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="https://invertornot.com">
    <meta name="twitter:image" content="https://invertornot.com/static/queen_victoria.png">
    <meta name="twitter:description"
        content="InvertOrNot.com is a website for classifying images by how to display in web dark-mode">
    <meta name="twitter:title" content="InvertOrNot">
    <meta name="twitter:creator" content="mattismegevand">
    <link rel="icon" href="static/favicon.png" type="image/x-icon">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700&family=IBM+Plex+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="static/style.css">
</head>

<body>
    <div class="container">
        <h1>InvertOrNot</h1>
        <p>
            Make your app's dark-mode smarter with InvertOrNot. Our API predicts if an image should be inverted for
            optimal
            dark-mode rendering. <br>
            This API is free, and is open source (both the code and the weights of the model are <a
                href="https://github.com/mattismegevand/invertornot">available</a>).
        </p>

        <img src="static/examples.png" width="100%" alt="Example of outputs">

        <h4>Try it out</h4>
        <p>Upload an image to see InvertOrNot what transformation it would apply to it.</p>
        <div style="border-style: solid; padding: 20px; border-color: var(--accent-color);">
            <div style="width: 100%; display: flex; justify-content: space-between;">
                <button onclick="testRandomImage()">Classifiy & Test Random Image!</button>
                <div>
                    <input type="file" id="imageUpload" accept="image/*">
                    <button onclick="transformImage()">Classify & Transform Image!</button>
                </div>
            </div>
            <div class="image-display-area">
                <div id="originalImageContainer" class="hidden">
                    <h4>Original Image</h4>
                    <img src="" alt="Original image" class="result-image">
                </div>

                <div id="transformedImageContainer" class="hidden">
                    <h4>Transformed Image</h4>
                    <img src="" alt="Transformed image" class="result-image">
                </div>

            </div>
        </div>

        <h4>Background</h4>
        <p>
            Despite dark-mode's popularity, images often aren't automatically adapted to fit it.
            The conservative approach is to reduce the brightness of the image, which can degrade it significantly.
            Inverting the image can be a better solution, but it can't be applied to all images (see the poor Queen
            Victoria).<br>
            Using our API you can make your website more pleasant to use in dark-mode, without having to manually adapt
            each image.
        </p>

        <h4>How does it work?</h4>
        <p>The API works by finetuning an <a href="https://arxiv.org/abs/1905.11946">EfficientNet</a> model on a custom
            dataset using PyTorch. By using deep learning we are able to
            have a
            much more reliable approach to solve this problem, the only alternative being heuristics.</p>

        <h4>How can I use it?</h4>
        Documentation is available <a href="/docs/">here</a>. If possible cache or store the results provided by the API
        to avoid unnecessary calls.
        <br>
        <br>
        <table style="width: 100%;">
            <thead>
                <tr>
                    <th>Endpoint</th>
                    <th>Method</th>
                    <th>Input</th>
                    <th>Output</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><code>/api/file</code></td>
                    <td><code>POST</code></td>
                    <td>List of image files</td>
                    <td>List of <code>{invert, sha1, error}</code> for each file.</td>
                </tr>
                <tr>
                    <td><code>/api/url</code></td>
                    <td><code>POST</code></td>
                    <td>List of image URLs</td>
                    <td>List of <code>{invert, sha1, error, url}</code> for each URL.</td>
                </tr>
                <tr>
                    <td><code>/api/sha1</code></td>
                    <td><code>POST</code></td>
                    <td>List of SHA-1 hashes</td>
                    <td>List of <code>{invert, sha1, error}</code> for each SHA-1.</td>
                </tr>
            </tbody>
        </table>

        <br>
        Example of a request:
        <pre>
            <code>
                curl -X 'POST' \
                  'https://invertornot.com/api/url' \
                  -H 'accept: application/json' \
                  -H 'Content-Type: application/json' \
                  -d '[
                  "https://upload.wikimedia.org/wikipedia/commons/e/e3/Queen_Victoria_by_Bassano.jpg"
                ]'
            </code>
        </pre>
        Response:
        <pre>
            <code>
                [
                  {
                    "invert": 0,
                    "sha1": "da487e2e9855362b4a5f4fdb531c55ae47ac6e1b",
                    "error": "",
                    "url": "https://upload.wikimedia.org/wikipedia/commons/e/e3/Queen_Victoria_by_Bassano.jpg"
                  }
                ]
            </code>
        </pre>

        If you've never adapted images for dark-mode, here's a quick example of what the CSS can look like:
        <ul>
            <li>no inversion: <code>filter: grayscale(50%);</code></li>
            <li>inversion: <code>filter: grayscale(50%) invert(100%) brightness(95%) hue-rotate(180deg);</code></li>
        </ul>
        Feel free to tweak these based on your dark mode setup.

        <h4>Goal</h4>
        <p>
            InvertOrNot is a public demonstration and proof of concept of using a NN classifier to choose how to
            handle images
            in dark-mode.
        </p>

        <h4>Support</h4>
        <p>
            InvertOrNot offers no warranties or guaranties and is done on a best-effort basis.
            If you need reliable or large-scale inversion APIs, I strongly recommend you download the FLOSS code and
            model and run your own instance. The model is lightweight (16MB) and can be run on a CPU (≈ 100ms using ONNX
            Runtime).
        </p>

        <h4>Side note</h4>
        <p>
            Images may be retained for training purposes. Should you prefer your images not be saved, hosting your own
            instance
            is recommended. Additionally, it's important to note that these images will not be distributed; they are
            solely used
            for training purposes
        </p>

        <div class="footer" style="padding: 20px; font-family: 'Courier New', Courier, monospace;">
            <div style="float: left;">
                Made by <a href="https://mattismegevand.com">Mattis Megevand</a>, code <a
                    href="https://github.com/mattismegevand/invertornot/">here</a></div>
            <div style="float: right;">
                This idea was inspired by <a href="https://gwern.net/idea#invertornot">Gwern</a>
            </div>
        </div>
    </div>

    <script>
        async function transformImage() {
            const input = document.getElementById('imageUpload');
            if (input.files.length > 0) {
                const formData = new FormData();
                formData.append('files', input.files[0]);

                try {
                    const response = await fetch('/api/file', {
                        method: 'POST',
                        body: formData,
                    });

                    if (response.ok) {
                        const results = await response.json();
                        const result = results[0];

                        if (result.error && result.error !== "") {
                            console.error('Error from API:', result.error);
                        } else {
                            displayImages(input.files[0], result.invert);
                        }
                    } else {
                        console.error('API call failed:', response.status);
                    }
                } catch (error) {
                    console.error('Error calling the API:', error);
                }
            } else {
                alert('Please select a file to upload.');
            }
        }

        function displayImages(file, shouldInvert) {
            const reader = new FileReader();
            reader.onload = function (e) {
                const originalImgContainer = document.getElementById('originalImageContainer');
                const transformedImgContainer = document.getElementById('transformedImageContainer');
                const originalImage = originalImgContainer.querySelector('img');
                const transformedImage = transformedImgContainer.querySelector('img');

                originalImage.src = e.target.result;
                originalImage.style.display = 'block';
                originalImgContainer.classList.remove('hidden');

                transformedImage.src = e.target.result;
                transformedImage.style.display = 'block';
                transformedImgContainer.classList.remove('hidden');
                transformedImage.style.filter = shouldInvert === 1 ? 'grayscale(50%) invert(100%) brightness(95%) hue-rotate(180deg)' : 'none';
            };
            reader.readAsDataURL(file);
        }
        async function testRandomImage() {
            const imageURLs = [
                'https://upload.wikimedia.org/wikipedia/commons/thumb/2/27/Keylong_West_Lahaul_Himachal_Oct22_A7C_03375_panorama.jpg/800px-Keylong_West_Lahaul_Himachal_Oct22_A7C_03375_panorama.jpg', // Replace URL_1, URL_2, etc., with actual URLs
                'https://upload.wikimedia.org/wikipedia/commons/thumb/d/da/Recall_graph_for_many_Ks.png/800px-Recall_graph_for_many_Ks.png',
                'https://upload.wikimedia.org/wikipedia/commons/thumb/c/c7/Graph_example_%28Graph_theory%29.png/508px-Graph_example_%28Graph_theory%29.png',
                'https://upload.wikimedia.org/wikipedia/commons/4/41/Graph_of_Bicycle_Speed.png',
                'https://upload.wikimedia.org/wikipedia/commons/thumb/2/2d/Swinging_factorial_graph_%28logarithmic_scale%29.png/800px-Swinging_factorial_graph_%28logarithmic_scale%29.png',
                'https://upload.wikimedia.org/wikipedia/commons/thumb/5/59/QALY_graph-en.svg/750px-QALY_graph-en.svg.png',
                'https://upload.wikimedia.org/wikipedia/commons/c/c3/Distinctiveness_Centrality.png',
                'https://upload.wikimedia.org/wikipedia/commons/a/a9/MURDERS_IN_NEW_YORK_CITY_BY_YEAR.png',
                'https://upload.wikimedia.org/wikipedia/commons/thumb/4/4c/Graph_of_Cattle_slaughtered_in_2020.jpg/654px-Graph_of_Cattle_slaughtered_in_2020.jpg',
                'https://upload.wikimedia.org/wikipedia/commons/thumb/6/64/Theta1%3D0.png/800px-Theta1%3D0.png',
                'https://upload.wikimedia.org/wikipedia/commons/thumb/8/88/Graph_of_Number_of_Mass_Incidents_in_China.jpg/800px-Graph_of_Number_of_Mass_Incidents_in_China.jpg',
                'https://upload.wikimedia.org/wikipedia/commons/1/16/Graph_kt.png',
                'https://upload.wikimedia.org/wikipedia/commons/thumb/c/c4/Njemačka.png/800px-Njemačka.png',
                'https://upload.wikimedia.org/wikipedia/commons/thumb/1/1b/Temperature_Bar_Chart_Pacific-Nauru--1909-2020--2021-07-13.png/800px-Temperature_Bar_Chart_Pacific-Nauru--1909-2020--2021-07-13.png',
                'https://upload.wikimedia.org/wikipedia/commons/d/df/Adobe_Flex_ColumnChart.png',
                'https://upload.wikimedia.org/wikipedia/commons/thumb/d/d8/Ipcc_2014_bar_graph.png/633px-Ipcc_2014_bar_graph.png',
                'https://www.splashlearn.com/math-vocabulary/wp-content/uploads/2022/05/graphs-3-01.png',
                'https://upload.wikimedia.org/wikipedia/commons/b/b5/Xkcd_philosophy.png',
                'https://upload.wikimedia.org/wikipedia/commons/e/e8/StAr_TrEk_InTo_DaRkNeSs_%28xkcd%29.png',
                'https://upload.wikimedia.org/wikipedia/commons/thumb/6/6c/Kiki_Noire_et_Blanche_-_Man_Ray_%2825781166518%29.jpg/800px-Kiki_Noire_et_Blanche_-_Man_Ray_%2825781166518%29.jpg',
                'https://upload.wikimedia.org/wikipedia/commons/thumb/3/38/VanGogh_1887_Selbstbildnis.jpg/475px-VanGogh_1887_Selbstbildnis.jpg',
                'https://upload.wikimedia.org/wikipedia/commons/thumb/e/ed/Dama_z_gronostajem.jpg/435px-Dama_z_gronostajem.jpg',
                'https://upload.wikimedia.org/wikipedia/commons/thumb/6/65/Portrait_of_a_Woman_MET_DP162139.jpg/482px-Portrait_of_a_Woman_MET_DP162139.jpg',
                'https://upload.wikimedia.org/wikipedia/commons/thumb/2/21/Portrait_of_a_Woman_MET_ep22.174.bw.R.jpg/482px-Portrait_of_a_Woman_MET_ep22.174.bw.R.jpg',
                'https://upload.wikimedia.org/wikipedia/commons/thumb/a/a5/Portrait_of_a_Woman_MET_SLP0129.jpg/436px-Portrait_of_a_Woman_MET_SLP0129.jpg',
                'https://upload.wikimedia.org/wikipedia/commons/thumb/c/cd/John_McCoy_portrait_painting.jpg/480px-John_McCoy_portrait_painting.jpgohttps://upload.wikimedia.org/wikipedia/commons/thumb/2/21/John_F_Kennedy_Official_Portrait.jpg/405px-John_F_Kennedy_Official_Portrait.jpg',
                'https://upload.wikimedia.org/wikipedia/commons/1/13/Portrait_of_Anna_Christopher%2C_probably_between_1880_and_1889_%28PEISER_191%29.jpg',
                'https://upload.wikimedia.org/wikipedia/commons/thumb/7/7b/Portrait_of_General_Sébastiani%2C_after_Gérard_Met_DP890254.jpg/435px-Portrait_of_General_Sébastiani%2C_after_Gérard_Met_DP890254.jpg',
                'https://upload.wikimedia.org/wikipedia/commons/thumb/7/73/Portrait_of_François_Le_Bloy_Met_DP887881.jpg/449px-Portrait_of_François_Le_Bloy_Met_DP887881.jpg',
                'https://upload.wikimedia.org/wikipedia/commons/thumb/a/ab/Esztergom_by_night_01_-_Simor_János_utca.jpg/800px-Esztergom_by_night_01_-_Simor_János_utca.jpg',
                'https://upload.wikimedia.org/wikipedia/commons/thumb/1/14/Landscape_Arnisee-region.JPG/800px-Landscape_Arnisee-region.JPG',
                'https://upload.wikimedia.org/wikipedia/commons/thumb/8/8a/Landscape%2C_South_Wales.jpg/800px-Landscape%2C_South_Wales.jpg',
                'https://upload.wikimedia.org/wikipedia/commons/thumb/8/80/NYC_wideangle_south_from_Top_of_the_Rock.jpg/800px-NYC_wideangle_south_from_Top_of_the_Rock.jpg',
                'https://upload.wikimedia.org/wikipedia/commons/thumb/a/a4/Hong_Kong_Harbour_Night_2019-06-11.jpg/800px-Hong_Kong_Harbour_Night_2019-06-11.jpg',
                'https://upload.wikimedia.org/wikipedia/commons/thumb/c/cf/2017-07-30-21h55m18.jpg/800px-2017-07-30-21h55m18.jpg',
                'https://upload.wikimedia.org/wikipedia/commons/thumb/1/1d/Budapest_SPOT_1022.jpg/600px-Budapest_SPOT_1022.jpg',
                'https://upload.wikimedia.org/wikipedia/commons/3/31/City_Walls_-_geograph.org.uk_-_4330970.jpg',
                'https://upload.wikimedia.org/wikipedia/commons/thumb/1/1c/Futuh_al-Haramain_%28Description_of_the_Holy_Cities%29_MET_DP285258.jpg/450px-Futuh_al-Haramain_%28Description_of_the_Holy_Cities%29_MET_DP285258.jpg',
                'https://upload.wikimedia.org/wikipedia/commons/thumb/d/dc/Édifice_Price_at_night%2C_Quebec_city%2C_Canada.jpg/800px-Édifice_Price_at_night%2C_Quebec_city%2C_Canada.jpg',
            ];

            const randomURL = imageURLs[Math.floor(Math.random() * imageURLs.length)];

            try {
                const response = await fetch('/api/url', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify([randomURL]),
                });

                if (response.ok) {
                    const results = await response.json();
                    const result = results[0];

                    if (result.error && result.error !== "") {
                        console.error('Error from API:', result.error);
                    } else {
                        displayRandomImage(randomURL, result.invert);
                    }
                } else {
                    console.error('API call failed:', response.status);
                }
            } catch (error) {
                console.error('Error calling the API:', error);
            }
        }

        function displayRandomImage(imageURL, shouldInvert) {
            const originalImgContainer = document.getElementById('originalImageContainer');
            const transformedImgContainer = document.getElementById('transformedImageContainer');
            const originalImage = originalImgContainer.querySelector('img');
            const transformedImage = transformedImgContainer.querySelector('img');

            originalImage.src = imageURL;
            originalImage.style.display = 'block';
            originalImgContainer.classList.remove('hidden');

            transformedImage.src = imageURL;
            transformedImage.style.display = 'block';
            transformedImgContainer.classList.remove('hidden');
            transformedImage.style.filter = shouldInvert === 1 ? 'grayscale(50%) invert(100%) brightness(95%) hue-rotate(180deg)' : 'grayscale(50%)';
        }
    </script>
</body>

</html>